<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Audio Player</title>
    <script src="https://unpkg.com/wavesurfer.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
      body {
        background-color: #1f2937;
        color: white;
        font-family: sans-serif;
      }
      .active-track {
        background-color: #4b5563;
      }
      .playlist-button {
        background-color: #374151;
      }
      .playlist-button:hover {
        background-color: #4b5563;
      }
    </style>
  </head>
  <body class="p-4">
    <div id="playlistList" class="space-y-2"></div>
    <div id="playerContainer" class="mt-8 hidden">
      <div class="flex justify-between items-center mb-2">
        <h2 id="playlistTitle" class="text-xl font-bold"></h2>
        <button id="playPause" class="bg-gray-700 px-4 py-2 rounded">Play</button>
      </div>
      <div id="waveform" class="mb-4 bg-gray-800 rounded h-24"></div>
      <div id="trackList" class="space-y-1"></div>
    </div>
    <div id="otherPlaylists" class="mt-8 space-y-2"></div>

    <script>
      const playlistList = document.getElementById("playlistList");
      const playerContainer = document.getElementById("playerContainer");
      const otherPlaylists = document.getElementById("otherPlaylists");
      const playlistTitle = document.getElementById("playlistTitle");
      const trackList = document.getElementById("trackList");
      const playPause = document.getElementById("playPause");
      const waveformContainer = document.getElementById("waveform");
      let wavesurfer;
      let currentTrackIndex = 0;
      let currentTracks = [];

      fetch("files.json")
        .then((res) => res.json())
        .then((data) => {
          renderPlaylistButtons(data, playlistList);

          function renderPlaylistButtons(playlists, container, selected = null) {
            container.innerHTML = "";
            playlists.forEach((pl, index) => {
              if (pl.playlist !== selected) {
                const button = document.createElement("button");
                button.className = "block w-full text-left playlist-button px-4 py-2 rounded";
                button.textContent = pl.playlist;
                button.onclick = () => loadPlaylist(pl, playlists);
                container.appendChild(button);
              }
            });
          }

          function loadPlaylist(playlist, allPlaylists) {
            playlistTitle.textContent = playlist.playlist;
            playerContainer.classList.remove("hidden");
            currentTracks = playlist.tracks;
            currentTrackIndex = 0;
            renderTrackList();
            loadTrack(currentTrackIndex);

            renderPlaylistButtons(allPlaylists, otherPlaylists, playlist.playlist);
          }

          function renderTrackList() {
            trackList.innerHTML = "";
            currentTracks.forEach((track, index) => {
              const div = document.createElement("div");
              div.className = `cursor-pointer px-4 py-2 rounded ${
                index === currentTrackIndex ? "active-track" : "bg-gray-700 hover:bg-gray-600"
              }`;
              div.textContent = track.title;
              div.onclick = () => {
                currentTrackIndex = index;
                loadTrack(index);
              };
              trackList.appendChild(div);
            });
          }

          function loadTrack(index) {
            if (wavesurfer) {
              wavesurfer.destroy();
            }
            const track = currentTracks[index];
            wavesurfer = WaveSurfer.create({
              container: waveformContainer,
              waveColor: '#9CA3AF',
              progressColor: '#D1D5DB',
              height: 96,
              barWidth: 2,
              responsive: true,
            });

            wavesurfer.load(track.file);

            wavesurfer.on('ready', () => {
              wavesurfer.play();
              playPause.textContent = "Pause";
              renderTrackList();
            });

            wavesurfer.on('finish', () => {
              if (currentTrackIndex + 1 < currentTracks.length) {
                currentTrackIndex++;
                loadTrack(currentTrackIndex);
              }
            });

            playPause.onclick = () => {
              if (wavesurfer.isPlaying()) {
                wavesurfer.pause();
                playPause.textContent = "Play";
              } else {
                wavesurfer.play();
                playPause.textContent = "Pause";
              }
            };
          }
        });
    </script>
  </body>
</html>
