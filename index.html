<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audio Player</title>
<script src="https://unpkg.com/wavesurfer.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background-color: #1a1a1a; color: #f0f0f0; }
  .scrolling {
    overflow: hidden;
    white-space: nowrap;
    display: inline-block;
    vertical-align: middle;
  }
  .scrolling.scroll {
    animation: scroll-text 8s linear infinite;
  }
  @keyframes scroll-text {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }
</style>
</head>
<body class="p-4">

<div id="playlists" class="space-y-8"></div>

<script>
fetch('files.json')
  .then(response => response.json())
  .then(playlists => {
    const playlistsContainer = document.getElementById('playlists');

    playlists.forEach((playlist, playlistIndex) => {
      const playlistDiv = document.createElement('div');

      const playlistHeader = document.createElement('div');
      playlistHeader.className = "flex items-center space-x-4 mb-2";

      const playPauseBtn = document.createElement('button');
      playPauseBtn.textContent = '▶';
      playPauseBtn.className = "bg-gray-700 px-3 py-1 rounded";

      const playlistTitle = document.createElement('span');
      playlistTitle.className = "scrolling font-bold text-lg max-w-[70%]";
      playlistTitle.textContent = playlist.playlist;

      playlistHeader.appendChild(playPauseBtn);
      playlistHeader.appendChild(playlistTitle);

      const waveformDiv = document.createElement('div');
      waveformDiv.id = `waveform-${playlistIndex}`;
      waveformDiv.className = "w-full h-16 mb-4";

      const trackList = document.createElement('ul');
      trackList.className = "space-y-1";

      let wavesurfer = WaveSurfer.create({
        container: waveformDiv,
        waveColor: '#555',
        progressColor: '#ccc',
        height: 64,
      });

      let currentTrackIndex = 0;

      function loadTrack(index) {
        const track = playlist.tracks[index];
        wavesurfer.load(track.file);
        highlightCurrentTrack(index);
      }

      function highlightCurrentTrack(index) {
        Array.from(trackList.children).forEach((li, i) => {
          li.className = i === index ? "text-yellow-400" : "";
        });
      }

      function playNextTrack() {
        if (currentTrackIndex < playlist.tracks.length - 1) {
          currentTrackIndex++;
          loadTrack(currentTrackIndex);
          wavesurfer.play();
        }
      }

      wavesurfer.on('finish', playNextTrack);

      playPauseBtn.addEventListener('click', () => {
        if (wavesurfer.isPlaying()) {
          wavesurfer.pause();
          playPauseBtn.textContent = '▶';
        } else {
          wavesurfer.play();
          playPauseBtn.textContent = '⏸';
        }
      });

      playlist.tracks.forEach((track, trackIndex) => {
        const li = document.createElement('li');
        li.textContent = track.title;
        li.className = "scrolling cursor-pointer max-w-full inline-block";
        li.addEventListener('click', () => {
          currentTrackIndex = trackIndex;
          loadTrack(currentTrackIndex);
          wavesurfer.play();
          playPauseBtn.textContent = '⏸';
        });
        trackList.appendChild(li);
      });

      playlistDiv.appendChild(playlistHeader);
      playlistDiv.appendChild(waveformDiv);
      playlistDiv.appendChild(trackList);
      playlistsContainer.appendChild(playlistDiv);

      loadTrack(currentTrackIndex);
    });

    // Apply scroll animation only if text is truncated
    function updateScrolling() {
      document.querySelectorAll('.scrolling').forEach(el => {
        if (el.scrollWidth > el.clientWidth) {
          el.classList.add('scroll');
        } else {
          el.classList.remove('scroll');
        }
      });
    }

    window.addEventListener('resize', updateScrolling);
    updateScrolling();
  });
</script>
</body>
</html>
