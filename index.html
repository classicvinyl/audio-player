<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simple Wavesurfer Playlist</title>
<script src="https://unpkg.com/wavesurfer.js"></script>
<style>
  body { background: #2a1a26; color: white; font-family: sans-serif; padding: 1rem; }
  .playlist { max-width: 600px; margin: 0 auto; }
  .track { cursor: pointer; padding: 0.5rem; border-radius: 0.3rem; display: flex; justify-content: space-between; }
  .track:hover { background: #3c2a36; }
  .track.active { background: grey; font-weight: bold; }
  .duration { color: #bbb; min-width: 40px; text-align: right; }
  #waveform { margin: 1rem 0; background: black; border-radius: 0.5rem; height: 120px; }
  #playPauseBtn { background: orange; border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; display: flex; align-items: center; justify-content: center; margin: auto; }
  #playPauseBtn svg { fill: white; width: 24px; height: 24px; }
  #loadingSpinner {
    border: 3px solid #f3f3f3;
    border-top: 3px solid orange;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    display: none;
    margin: 1rem auto;
  }
  @keyframes spin {
    0% { transform: rotate(0deg);}
    100% { transform: rotate(360deg);}
  }
</style>
</head>
<body>

<div class="playlist">
  <ul id="trackList"></ul>
  <div id="waveform"></div>
  <button id="playPauseBtn" aria-label="Play/Pause">
    <svg id="playIcon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>
    <svg id="pauseIcon" viewBox="0 0 24 24" style="display:none;">
      <rect x="6" y="5" width="4" height="14"></rect>
      <rect x="14" y="5" width="4" height="14"></rect>
    </svg>
  </button>
  <div id="loadingSpinner"></div>
</div>

<script>
  // Example playlist data (replace with fetch('files.json'))
  const playlist = [
    { title: "Track One", file: "https://cdn.jsdelivr.net/gh/freesoundorg/data@master/audio_ogg/field_recordings/river.ogg" },
    { title: "Track Two", file: "https://cdn.jsdelivr.net/gh/freesoundorg/data@master/audio_ogg/field_recordings/birds.ogg" }
  ];

  const trackListEl = document.getElementById('trackList');
  const playPauseBtn = document.getElementById('playPauseBtn');
  const playIcon = document.getElementById('playIcon');
  const pauseIcon = document.getElementById('pauseIcon');
  const loadingSpinner = document.getElementById('loadingSpinner');
  let currentTrackIndex = 0;
  let isPlaying = false;
  let wavesurfer = null;
  let trackDurations = [];

  function formatTime(sec) {
    const m = Math.floor(sec / 60);
    const s = Math.floor(sec % 60).toString().padStart(2, '0');
    return `${m}:${s}`;
  }

  // Initialize Wavesurfer
  function initWaveSurfer() {
    if (wavesurfer) {
      wavesurfer.destroy();
    }
    wavesurfer = WaveSurfer.create({
      container: '#waveform',
      waveColor: 'white',
      progressColor: 'orange',
      height: 120,
      backend: 'MediaElement'
    });

    wavesurfer.on('ready', () => {
      loadingSpinner.style.display = 'none';
      isPlaying = true;
      wavesurfer.play();
      updatePlayPauseIcon();
      updateTrackDuration(currentTrackIndex);
    });

    wavesurfer.on('error', () => {
      loadingSpinner.style.display = 'none';
      alert('Error loading track. Trying next track.');
      playNextTrack();
    });

    wavesurfer.on('finish', () => {
      playNextTrack();
    });

    wavesurfer.on('loading', (percent) => {
      loadingSpinner.style.display = 'block';
    });
  }

  // Load a track by index
  function loadTrack(index) {
    if (index < 0 || index >= playlist.length) return;
    currentTrackIndex = index;
    setActiveTrack();
    loadingSpinner.style.display = 'block';
    wavesurfer.load(playlist[index].file);
  }

  function playNextTrack() {
    let nextIndex = currentTrackIndex + 1;
    if (nextIndex >= playlist.length) {
      nextIndex = 0; // loop back to start
    }
    loadTrack(nextIndex);
  }

  function setActiveTrack() {
    const items = trackListEl.querySelectorAll('li');
    items.forEach((el, i) => {
      el.classList.toggle('active', i === currentTrackIndex);
    });
  }

  function updatePlayPauseIcon() {
    if (isPlaying) {
      playIcon.style.display = 'none';
      pauseIcon.style.display = 'block';
    } else {
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';
    }
  }

  function updateTrackDuration(index) {
    // Create a temp Audio to get duration for display
    const audio = new Audio(playlist[index].file);
    audio.addEventListener('loadedmetadata', () => {
      const durationStr = formatTime(audio.duration);
      const li = trackListEl.children[index];
      if (li) {
        li.querySelector('.duration').textContent = durationStr;
      }
    });
  }

  function buildPlaylistUI() {
    playlist.forEach((track, i) => {
      const li = document.createElement('li');
      li.className = 'track';
      li.innerHTML = `
        <span>${track.title}</span>
        <span class="duration">--:--</span>
      `;
      li.addEventListener('click', () => {
        loadTrack(i);
      });
      trackListEl.appendChild(li);
      updateTrackDuration(i);
    });
  }

  playPauseBtn.addEventListener('click', () => {
    if (!wavesurfer) return;
    if (isPlaying) {
      wavesurfer.pause();
      isPlaying = false;
    } else {
      wavesurfer.play();
      isPlaying = true;
    }
    updatePlayPauseIcon();
  });

  // Init
  initWaveSurfer();
  buildPlaylistUI();
  loadTrack(0);
</script>

</body>
</html>
