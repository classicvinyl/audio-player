<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>UOUS Player</title>
    <script src="https://unpkg.com/wavesurfer.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <style>
      body {
        background-color: #121212;
        font-family: 'Helvetica Neue', sans-serif;
        color: #fff;
      }
      .track-card {
        padding: 1rem;
        border: 1px solid #444;
        border-radius: 0.75rem;
        box-shadow: 0 2px 6px rgba(255 85 0 / 0.3);
        user-select: none;
      }
      .track-card:hover {
        background-color: #1e1e1e;
      }
      .play-btn {
        background: transparent;
        border: none;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
      }
      /* SoundCloud style round play icon */
      .play-icon {
        width: 20px;
        height: 20px;
        clip-path: polygon(0% 0%, 100% 50%, 0% 100%);
        background-color: #ff5500;
        border-radius: 50%;
      }
      /* SoundCloud style pause icon */
      .pause-icon {
        width: 20px;
        height: 20px;
        display: flex;
        justify-content: space-between;
      }
      .pause-icon > div {
        background-color: #ff5500;
        width: 6px;
        height: 20px;
        border-radius: 2px;
      }
      .track-title {
        font-size: 1.25rem;
        font-weight: 600;
        flex: 1;
        margin-right: 1rem;
        word-break: break-word; /* wrap long titles */
      }
      .track-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      @media (max-width: 640px) {
        .track-title {
          font-size: 1rem;
          margin-right: 0.75rem;
          max-width: 70vw;
        }
      }
    </style>
  </head>
  <body class="min-h-screen p-6">
    <div id="track-list" class="space-y-6"></div>

    <script>
      const repoURL = "https://classicvinyl.github.io/audio-player";
      const jsonURL = `${repoURL}/files.json`;

      async function loadTracks() {
        const res = await fetch(jsonURL);
        const tracks = await res.json();

        const list = document.getElementById("track-list");
        list.innerHTML = ''; // Clear existing tracks on reload

        const wavesurfers = [];

        tracks.forEach((track, i) => {
          const id = `waveform-${i}`;

          const container = document.createElement("div");
          container.className = "track-card";

          container.innerHTML = `
            <div class="track-header">
              <div class="track-title">${track.title.replace(/\.mp3$/i, '')}</div>
              <button class="play-btn" data-id="${id}" aria-label="Play/pause">
                <div class="play-icon"></div>
              </button>
            </div>
            <div id="${id}" class="mt-3"></div>
          `;

          list.appendChild(container);

          const wavesurfer = WaveSurfer.create({
            container: `#${id}`,
            waveColor: '#666',
            progressColor: '#ff5500',
            height: 60,
            barWidth: 2,
            responsive: true,
            normalize: true,
          });

          wavesurfer.load(`${repoURL}/${track.file}`);

          const btn = container.querySelector(".play-btn");

          wavesurfers.push({ ws: wavesurfer, btn: btn });

          btn.addEventListener("click", () => {
            if (wavesurfer.isPlaying()) {
              wavesurfer.pause();
              btn.innerHTML = `<div class="play-icon"></div>`;
            } else {
              // Pause all other wavesurfers and reset their buttons
              wavesurfers.forEach(({ ws, btn: otherBtn }) => {
                if (ws !== wavesurfer) {
                  ws.pause();
                  otherBtn.innerHTML = `<div class="play-icon"></div>`;
                }
              });
              wavesurfer.play();
              btn.innerHTML = `
                <div class="pause-icon">
                  <div></div><div></div>
                </div>`;
            }
          });

          wavesurfer.on('finish', () => {
            btn.innerHTML = `<div class="play-icon"></div>`;
          });
        });
      }

      loadTracks();
    </script>
  </body>
</html>
